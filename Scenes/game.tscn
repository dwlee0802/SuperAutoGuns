[gd_scene load_steps=12 format=3 uid="uid://2lh8spf0pqoc"]

[ext_resource type="Script" path="res://Scripts/GameManager.gd" id="1_su57y"]
[ext_resource type="PackedScene" uid="uid://4hb2vpnf6a6n" path="res://Scenes/user_interface.tscn" id="2_2mya4"]
[ext_resource type="Script" path="res://Scripts/tutorial.gd" id="3_tp731"]
[ext_resource type="Script" path="res://Scripts/FundsButton.gd" id="4_cxk1o"]
[ext_resource type="PackedScene" uid="uid://dq1g0sudslgo5" path="res://Scenes/research_ui.tscn" id="6_mxhfq"]
[ext_resource type="Script" path="res://addons/graph_2d/graph_2d.gd" id="7_creg4"]
[ext_resource type="Texture2D" uid="uid://dcok1gh3b1epc" path="res://Art/32x32_white_square.png" id="7_dtyuk"]

[sub_resource type="ButtonGroup" id="ButtonGroup_tx2ih"]
allow_unpress = true

[sub_resource type="Animation" id="Animation_tqs2y"]
resource_name = "new_battle_start_anim"
length = 2.25
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4, 1.9, 2.2),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1), Color(1, 1, 1, 1), Color(1, 1, 1, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.4, 2.2),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}

[sub_resource type="Animation" id="Animation_f0b81"]
resource_name = "operation_over_anim"
length = 0.5
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath(".:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.4),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0), Color(1, 1, 1, 1)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath(".:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0.4),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_k8hpl"]
_data = {
"new_battle_start_anim": SubResource("Animation_tqs2y"),
"operation_over_anim": SubResource("Animation_f0b81")
}

[node name="Game" type="Control"]
texture_filter = 1
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = ExtResource("1_su57y")

[node name="CycleTimer" type="Timer" parent="."]
wait_time = 0.5
one_shot = true

[node name="CycleCountLabel" type="Label" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -27.0
offset_top = -357.0
offset_right = 32.0
offset_bottom = -334.0
grow_horizontal = 2
grow_vertical = 2
text = "Cycle: 0"

[node name="BattleCountLabel" type="Label" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -31.0
offset_top = -380.0
offset_right = 33.0
offset_bottom = -357.0
grow_horizontal = 2
grow_vertical = 2
text = "Battle: 0"

[node name="BattleResultLabel" type="Label" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -49.0
offset_top = -336.0
offset_right = 58.0
offset_bottom = -313.0
grow_horizontal = 2
grow_vertical = 2
text = "Player Victory"

[node name="EffectiveDamageUI" type="Control" parent="."]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = 646.0
offset_top = 219.0
offset_right = 686.0
offset_bottom = 219.0
grow_horizontal = 2
grow_vertical = 2

[node name="PlayerLabel" type="Label" parent="EffectiveDamageUI"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -77.0
offset_top = -7.0
offset_right = 77.0
offset_bottom = 7.0
grow_horizontal = 2
grow_vertical = 2
theme_override_font_sizes/font_size = 10
horizontal_alignment = 1
vertical_alignment = 1

[node name="EnemyLabel" type="Label" parent="EffectiveDamageUI"]
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -77.0
offset_top = 4.0
offset_right = 77.0
offset_bottom = 18.0
grow_horizontal = 2
grow_vertical = 2
theme_override_font_sizes/font_size = 10
horizontal_alignment = 1
vertical_alignment = 1

[node name="UserInterface" parent="." instance=ExtResource("2_2mya4")]
layout_mode = 1
attackColor = Color(1, 0.833888, 0.806373, 1)
defendColor = Color(0.761398, 0.841342, 0.999999, 1)
middleColor = Color(0.836663, 0.732309, 0.704853, 1)

[node name="CTKLabel" type="Label" parent="."]
layout_mode = 0
offset_left = 1161.0
offset_top = 116.0
offset_right = 1214.0
offset_bottom = 153.0
theme_override_font_sizes/font_size = 12
text = "Left: 000
Righ: 000"

[node name="Tutorial" type="Control" parent="."]
layout_mode = 1
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_top = -40.0
offset_right = 40.0
grow_vertical = 0
script = ExtResource("3_tp731")

[node name="ENGButton" type="Button" parent="Tutorial"]
visible = false
layout_mode = 0
offset_left = 81.0
offset_top = 1.0
offset_right = 150.0
offset_bottom = 32.0
text = "Tutorial"

[node name="KORButton" type="Button" parent="Tutorial"]
layout_mode = 0
offset_left = 2.0
offset_top = 1.0
offset_right = 74.0
offset_bottom = 32.0
toggle_mode = true
text = "튜토리얼"

[node name="ENGTutorial" type="Panel" parent="Tutorial"]
visible = false
layout_mode = 0
offset_top = -342.0
offset_right = 259.0
offset_bottom = -8.0

[node name="Label" type="Label" parent="Tutorial/ENGTutorial"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2

[node name="KORTutorial" type="Panel" parent="Tutorial"]
visible = false
custom_minimum_size = Vector2(270, 500)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
offset_left = 2.0
offset_top = -823.0
offset_right = 234.0
offset_bottom = -49.0
grow_horizontal = 2
grow_vertical = 2

[node name="Label" type="Label" parent="Tutorial/KORTutorial"]
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
theme_override_font_sizes/font_size = 12
text = "튜토리얼

조작법
좌클릭 - 유닛 선택
우클릭 - 선택 유닛 배치
Commit 버튼(초록) - 턴 종료
Heal 버튼(빨강) - 유닛 치료(단축키 H)
Sell 버튼(노랑) - 유닛 판매(50% 환불)


기본 정보
유닛
Reinforcement(보충) 에서 유닛을 모집
Reserve(예비) 에 있는 유닛을 슬롯에 배치
배치 완료 후 Commit으로 턴 종
전투는 사이클로 이루어져 있음
유닛들은 일정 사이클 후에 공격과 이동과 같은 행동을 할 수 있음
공격 대상은 바로 앞의 적 우선
바로 앞 유닛이 없으면 가장 가까운 적 공격

공격과 수비
공격 팀과 수비 팀이 존재
공격 팀은 중간 1열을 통과해야 함
수비팀이 먼저 유닛을 배치하고 공격 팀은 그 다음에 배치
유닛이 먼저 전멸하는 쪽이 패배
같은 사이클에 양측 모두 전멸하면 수비팀 승리대
공격팀이 승리하면 영토를 점령하고 계속 공격
공격이 실패하면 공수 교
영토를 먼저 잃은 쪽이 게임 패배

경제
매 턴 돈이 들어옴
수도와 가까울수록 돈이 많이 들어옴
전투를 계속할수록 들어오는 돈도 많아짐"
autowrap_mode = 2

[node name="EconomyUI" type="Control" parent="."]
anchors_preset = 0
offset_left = 1253.0
offset_top = 167.0
offset_right = 1317.0
offset_bottom = 231.0
scale = Vector2(0.5, 0.5)

[node name="FundsButton" type="Button" parent="EconomyUI"]
layout_mode = 0
offset_right = 100.0
offset_bottom = 56.0
theme_override_font_sizes/font_size = 20
toggle_mode = true
button_pressed = true
button_group = SubResource("ButtonGroup_tx2ih")
text = "Funds"
script = ExtResource("4_cxk1o")

[node name="IncomeButton" type="Button" parent="EconomyUI"]
layout_mode = 0
offset_left = 104.0
offset_right = 198.0
offset_bottom = 56.0
theme_override_font_sizes/font_size = 20
toggle_mode = true
button_group = SubResource("ButtonGroup_tx2ih")
text = "Income"
script = ExtResource("4_cxk1o")
num = 1

[node name="TotalFundsButton" type="Button" parent="EconomyUI"]
layout_mode = 0
offset_left = 202.0
offset_right = 320.0
offset_bottom = 56.0
theme_override_font_sizes/font_size = 20
toggle_mode = true
button_group = SubResource("ButtonGroup_tx2ih")
text = "Total Funds"
script = ExtResource("4_cxk1o")
num = 2

[node name="Graph2D" type="Control" parent="EconomyUI"]
anchors_preset = 0
offset_left = 2.0
offset_top = 76.0
offset_right = 666.0
offset_bottom = 488.0
script = ExtResource("7_creg4")
x_max = 25.0
show_x_ticks = false
show_x_numbers = false
y_max = 100.0
grid_horizontal_visible = true
grid_vertical_visible = true

[node name="ResearchUI" parent="." instance=ExtResource("6_mxhfq")]
custom_minimum_size = Vector2(300, 400)
layout_mode = 1
anchors_preset = 0
anchor_right = 0.0
anchor_bottom = 0.0
offset_left = 1254.0
offset_top = 423.0
offset_right = 1586.0
offset_bottom = 868.0
grow_horizontal = 1
grow_vertical = 1

[node name="DebugMenu" type="Control" parent="."]
anchors_preset = 0
offset_right = 40.0
offset_bottom = 40.0

[node name="Add10FundsButton" type="Button" parent="DebugMenu"]
layout_mode = 0
offset_right = 8.0
offset_bottom = 8.0
text = "Add 10 Funds"

[node name="BattleStartOverlay" type="TextureRect" parent="."]
visible = false
modulate = Color(1, 1, 1, 0)
self_modulate = Color(0, 0, 0, 0.811765)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 0
texture = ExtResource("7_dtyuk")
expand_mode = 1

[node name="Label" type="RichTextLabel" parent="BattleStartOverlay"]
custom_minimum_size = Vector2(400, 0)
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -92.5
offset_top = -24.5
offset_right = 92.5
offset_bottom = 24.5
grow_horizontal = 2
grow_vertical = 2
bbcode_enabled = true
text = "Battle #0 Concluded

Player Offensive Victory

Lasted 0 Cycles"
fit_content = true
scroll_active = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="BattleStartOverlay"]
libraries = {
"": SubResource("AnimationLibrary_k8hpl")
}

[node name="GameConcludedOverlay" type="TextureRect" parent="."]
visible = false
self_modulate = Color(0, 0, 0, 0.811765)
layout_mode = 1
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
mouse_filter = 0
texture = ExtResource("7_dtyuk")
expand_mode = 1

[node name="Label" type="RichTextLabel" parent="GameConcludedOverlay"]
custom_minimum_size = Vector2(400, 0)
layout_mode = 1
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -92.5
offset_top = -24.5
offset_right = 92.5
offset_bottom = 24.5
grow_horizontal = 2
grow_vertical = 2
bbcode_enabled = true
text = "[center]
Operation Over

Player Victory

Lasted 0 Battles 
[/center]"
fit_content = true
scroll_active = false

[node name="AnimationPlayer" type="AnimationPlayer" parent="GameConcludedOverlay"]
libraries = {
"": SubResource("AnimationLibrary_k8hpl")
}

[node name="RestartButton" type="Button" parent="GameConcludedOverlay"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -73.5
offset_top = 280.0
offset_right = 73.5
offset_bottom = 15.5
grow_horizontal = 2
grow_vertical = 2
text = "Restart Operation"

[node name="QuitButton" type="Button" parent="GameConcludedOverlay"]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
offset_left = -21.0
offset_top = 360.0
offset_right = 21.0
offset_bottom = 15.5
grow_horizontal = 2
grow_vertical = 2
text = "Quit"

[connection signal="toggled" from="Tutorial/KORButton" to="Tutorial" method="_on_kor_button_toggled"]
[connection signal="pressed" from="EconomyUI/FundsButton" to="." method="_on_economy_ui_buttton_pressed" binds= [0]]
[connection signal="pressed" from="EconomyUI/IncomeButton" to="." method="_on_economy_ui_buttton_pressed" binds= [1]]
[connection signal="pressed" from="EconomyUI/TotalFundsButton" to="." method="_on_economy_ui_buttton_pressed" binds= [2]]
